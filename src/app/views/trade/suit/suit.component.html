
<mat-spinner *ngIf="spinnerLoading"></mat-spinner>

<mat-card *ngIf="!spinnerLoading">
  <div class="container">
      <!-- <h5>Merchnat partner survey</h5> -->
      <div class='branner'>
          <img src="assets/img/brand/MPAM-logo.png" />
      </div>

      <nav class="navbar navbar-light bg-light">
          <form class="form-inline" [formGroup]="form" #custForm="ngForm" >
            <span *ngIf="!verifyFLag">
                <input class="form-control mr-sm-2" type="search" placeholder="{{ formService.label_idCard }}" aria-label="Search"
                formControlName="pid" [(ngModel)]="survey.pid"  >

                <a *ngIf="!INTERNAL_USER" mat-flat-button   class="btn btn-outline-success my-2 my-sm-0"  (click)="getCustomerData()">{{ formService.LABEL_SEARCH }} <i class="fas fa-search"></i> </a>
            </span>

            <ul class="nav navbar-nav ml-auto" *ngIf="verifyFLag">
                <li >
                    <strong>{{ formService.label_Welcome }}</strong>
                    <p> {{ customer.Title_Name_T }} {{ customer.First_Name_T }} {{ customer.Last_Name_T }}</p>
                </li>
                <!-- <a (click) = "onLogout()"><i class="fa fa-lock" ></i> Logout</a> -->
                <a (click) = "onLogout()" class="btn btn-outline-success my-2 my-sm-0" ><span class=" cui-account-logout" aria-hidden="true"></span> {{ formService.LABEL_EXIT }}</a>
            </ul>
          </form>
        </nav>
  </div>

  <!-- VERIFY -->
  <div *ngIf="needVerify" class="container">

          <!-- <h5>Request verify method.</h5> -->
          <div class="row form_section">
              <mat-radio-group  [(ngModel)]="verifyBy" class="col-lg-4 col-md-4 col-sm-4 display_block" >
                  <mat-radio-button value="DOB" (change)="verifyByChange($event)" [disabled]="!customer.Birth_Day"  >{{ formService.label_verify_dob }}</mat-radio-button>
                  <mat-radio-button value="OTP" (change)="verifyByChange($event)" [disabled]="this.customer.Mobile[0] + this.customer.Mobile[1] == PREFIX_MOBILE_ALLOW_SEND_SMS "  >
                      {{ formService.label_verify_otp }}</mat-radio-button>
                </mat-radio-group>

                <a *ngIf="!INTERNAL_USER && verifyBy=='OTP'" mat-flat-button  color="primary"  (click)="requestOTP()" >{{ formService.label_Request_otp }}</a>

          </div>

      <div id='div_DOB' *ngIf="verifyBy=='DOB'" class="form_section">
        <div class="row" >

            <!-- <form class="example-form"> -->
              <mat-form-field class="example-full-width">
                <input matInput placeholder={{formService.label_input_verify_dob}}  [(ngModel)]="verifyDOB_val" name="verifyDOB_val"  >
              </mat-form-field>
              <p>{{formService.label_verify_dob_Format}}</p>
            <!-- </form> -->
        </div>

        <div class="row">
          <a *ngIf="!INTERNAL_USER" mat-flat-button  color="primary"  (click)="verifyDOB()" class="col-md-4"> {{formService.LABEL_Verify}}</a>
        </div>
      </div>

      <!-- Verify OTP section -->
      <div id='div_OTP' *ngIf="verifyBy=='OTP'" class="form_section">

         <div id='OTP_INTRY' *ngIf="showOtpEntry" >
            <div class="row">
                <mat-form-field >
                    <input  matInput   placeholder="Please input OTP"    [(ngModel)]="verifyOTP_val"  />
                </mat-form-field>
            </div>
            <div class="row">
                <a *ngIf="!INTERNAL_USER" mat-flat-button  color="primary"  (click)="verifyConfirmOTP()" class="col-md-4"> {{formService.LABEL_Verify}}</a>
            </div>
         </div>
      </div>
  </div>

  <!-- ************* STEPPER  -->
  <div class='container' *ngIf="!saveAllComplete">
  <mat-horizontal-stepper labelPosition="bottom" linear  #stepper *ngIf="verifyFLag" class="col" >
  <!-- <mat-horizontal-stepper labelPosition="bottom"  #stepper *ngIf="verifyFLag" class="col" > -->
    <!-- ***************** #1  Persional Information Step-->

    <mat-step [stepControl]="cddFormGroup">

      <!--Person information-->
        <form [formGroup]="cddFormGroup" class="form_section">
          <ng-template matStepLabel>{{formService.STEPER_1}}</ng-template>
          <div class="stepper_action" >
              <button mat-flat-button  matStepperNext color="primary"  (click)=checkCDD_FormInvalid(cddFormGroup) >{{formService.LABEL_NEXT}} <i class="fas fa-chevron-right"></i></button>
          </div>
          <app-cust-cdd [custCode]="survey.pid" [cddFormGroup]="cddFormGroup" [cddData]="cddData"></app-cust-cdd>
        </form>

        <!-- <div class="row">
            <a mat-flat-button color="primary" (click)="savePersonInfo()" [disabled]="!modifyFlag"> Save</a>
        </div> -->

        <!-- FATCA -->
        <div class='row'>
          <!-- {{cddFormGroup.disabled}} -->
            <h5 >
              <span class="label_header">{{ formService.from_fatca_title }}</span>
            </h5>
            <form class="form_section">
                  <app-suit-tree-view [questions]="fatcaQuestions" [questionDisabled]="cddFormGroup.disabled"></app-suit-tree-view>
            </form>
        </div>
          <!-- FATCA -->

    </mat-step>

     <!-- ***************** #2 Information step-->
     <mat-step [stepControl]="register_formGroup" >
        <ng-template matStepLabel>{{formService.STEPER_2}}</ng-template>
        <div class="stepper_action" >
            <button mat-flat-button  matStepperPrevious color="accent" ><i class="fas fa-chevron-left"></i> {{formService.LABEL_BACK}}</button>
            <button mat-flat-button  matStepperNext color="primary" (click)=checkCDD_FormInvalid(register_formGroup) >{{formService.LABEL_NEXT}} <i class="fas fa-chevron-right"></i></button>
        </div>

            <div class='row '>
                <section class="example-section" >
                    <mat-checkbox [(ngModel)]="addrModifyFlag"  (change)="modifOnChange(addrModifyFlag)"  class="form_section" >{{formService.REQ_MODIFY}}</mat-checkbox>
                </section>
            </div>

        <!-- 2.1 Register Address  (SEQ = 1)-->
        <div>
            <mat-expansion-panel [(expanded)]='register_expanded'>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                      <span>{{ formService.register_addr_title }}</span>
                  </mat-panel-title>
                      <mat-panel-description *ngIf="!register_expanded && !mobile" class="form_section" >
                          {{re_addrData.Print_Address}}
                  </mat-panel-description>

                </mat-expansion-panel-header>
                <!-- <form [formGroup]="register_formGroup"> -->
                    <app-cust-addr [addrData]="re_addrData" [custCode]="survey.pid" [addrFormGroup]="register_formGroup" ></app-cust-addr>
                <!-- </form> -->
              </mat-expansion-panel>
        </div>

        <!-- 2.2 Work Address (SEQ = 3)-->
        <div>
            <mat-expansion-panel [(expanded)]='work_expanded'>
                <mat-expansion-panel-header>
                  <mat-panel-title >
                      <span>{{ formService.work_addr_title }}</span>
                  </mat-panel-title>
                  <mat-panel-description *ngIf="!work_expanded && !mobile" class="form_section">
                        {{work_addrData.Print_Address}}
                  </mat-panel-description>
                </mat-expansion-panel-header>

                <div>
                    <section class="example-section">
                        <mat-radio-group   [(ngModel)]="work_addrData.SameAs"  (change)="workAddrOnChange(work_addrData.SameAs)" [(disabled)]="!addrModifyFlag" >
                          <mat-radio-button class="example-margin" value="1">{{formService.label_addrAs_reg}}</mat-radio-button>
                          <mat-radio-button class="example-margin" value="9">{{formService.label_addr_oth}}</mat-radio-button>

                        </mat-radio-group>
                      </section>
                </div>
                <!-- <form [formGroup]="work_formGroup"> -->
                    <app-cust-addr *ngIf="showWorkAddr" [addrData]="work_addrData" [custCode]="survey.pid"  [addrFormGroup]="work_formGroup" ></app-cust-addr>
                <!-- </form> -->

              </mat-expansion-panel>
          </div>

          <!-- 2.3 Current Address (SEQ = 2)-->
          <div>
              <mat-expansion-panel [(expanded)]='current_expanded' >
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                        <span>{{ formService.contact_addr_title }}</span>
                    </mat-panel-title>
                    <mat-panel-description *ngIf="!current_expanded && !mobile" class="form_section">
                            {{cur_addrData.Print_Address}}
                    </mat-panel-description>
                  </mat-expansion-panel-header>

                  <div class='row'>
                      <section class="example-section" >
                          <mat-radio-group [(ngModel)]="cur_addrData.SameAs"  (change)="cuurAddrOnChange(cur_addrData.SameAs)"  [(disabled)]="!addrModifyFlag">
                              <mat-radio-button class="example-margin" value="1">{{formService.label_addrAs_reg}}</mat-radio-button>
                              <mat-radio-button class="example-margin" value="3">{{formService.label_addrAs_work}}</mat-radio-button>
                              <mat-radio-button class="example-margin" value="9">{{formService.label_addr_oth}}</mat-radio-button>
                            </mat-radio-group>
                        </section>
                  </div>

                  <!-- <form [formGroup]="current_formGroup"> -->
                      <app-cust-addr *ngIf="showCurrentAddr" [addrData]="cur_addrData" [custCode]="survey.pid"  [addrFormGroup]="current_formGroup"></app-cust-addr>
                  <!-- </form> -->

                </mat-expansion-panel>
            </div>

            <!-- <div class='row'>
                <mat-card-actions class="col-md-4">
                    <a mat-flat-button color="primary" (click)="saveAddrAll()"  > Save address.</a>
                </mat-card-actions>
            </div> -->

    </mat-step>

  <!-- ***************** #3  Suitability Step-->
    <mat-step [stepControl]="suitFormGroup"   >
          <!--Person information-->
          <form [formGroup]="suitFormGroup" >

            <ng-template matStepLabel>{{formService.STEPER_3}}</ng-template>
            <div class="stepper_action">
                <button mat-flat-button  matStepperPrevious color="accent" ><i class="fas fa-chevron-left"></i> {{formService.LABEL_BACK}}</button>
                <button mat-flat-button [disabled]= "canDoSuit || canSaveSuit"  matStepperNext color="primary" (click)=checkSuit_FormInvalid(suitFormGroup) >
                  {{formService.LABEL_NEXT}} <i class="fas fa-chevron-right"></i></button>
            </div>


                <div *ngIf="!canDoSuit && !canSaveSuit"  class="container center-screen form_section"  >
                    <h4>{{formService.label_RiskLevel}}  </h4>
                    <h4>
                      <span><input  matInput [(ngModel)]="cust_RiskLevel"  formControlName="cust_RiskLevel" readonly="true"> - {{ cust_RiskLevelTxt }} </span>
                    </h4>

                    <p>{{formService.label_EvaluatedDate}}: {{ cust_RiskDate | date:'yyyy-MM-dd' }}</p>
                    <p>{{ cust_RiskTypeInvestor }}</p>

                    <a (click)="canDoSuit =true;" class="btn btn-outline-success my-2 my-sm-0" ><i class="fas fa-pencil-alt"></i> {{formService.label_NewSurvey}}</a>
                </div>
            </form>

             <!-- Show Suit question  -->
            <div *ngIf="canDoSuit" >
            <form  class="form_section">
            <ul>
                <div *ngFor="let ques of suitQuestions" class="questions">

                    <span *ngIf="ques.id == 11" class="blue-txt">
                        <p>คำถามข้อ 11-12 ใช้เป็นข้อมูลเพิ่มเติมเพื่อประกอบการให้คำแนะนำ</p>
                      </span>

                      <span *ngIf="ques.id == 11" class="blue-txt">
                        <p>ใช้เฉพาะที่จะมีการลงทุนในอนุพันธ์และหุ้นกู้อนุพันธ์โดยตรงเท่านั้น</p>
                      </span>

                      <span *ngIf="ques.id == 12" class="blue-txt">
                        <p>ใช้เฉพาะที่จะมีการลงทุนในต่างประเทศ</p>
                      </span>

                      <span>{{ ques.id }}. {{ ques.name }} </span>
                      <div *ngIf="!ques.image == ''" class="q_image">
                        <img src="{{ ques.image }}" />
                      </div>

                  <span>{{ ques.id }}. {{ ques.name }} </span>
                  <div>
                    <ul>
                      <div *ngFor="let choice of ques.choices">

                        <div *ngIf="ques.multilchoice">
                          <input type="checkbox"
                          value=" {{ choice.score }}"
                          id="{{ choice.id }}"
                          [(ngModel)]="choice.answer"
                          [ngModelOptions]="{standalone: true}"
                          />
                          {{ choice.name }}
                        </div>

                        <div *ngIf="!ques.multilchoice">
                          <input
                            name="{{ ques.id }}"
                            id="{{ ques.id }}"
                            type="radio"
                            value="{{ choice.score }}"
                            [(ngModel)]="ques.answer"
                          />
                          {{ choice.name }}
                        </div>

                      </div>
                    </ul>
                  </div>
                </div>
              </ul>

              <mat-card-actions>
                  <button   mat-flat-button class="act_button"  color="warn"  (click)="suiteFormRESET()"  type="reset" >Reset </button>
                  <a mat-flat-button color="primary" (click)="calSuit()" class ="act_button"> {{formService.LABEL_CALCULATE}}</a>
                  <a mat-flat-button color="accent" (click)="canDoSuit =false;" class ="act_button"> {{formService.LABEL_CANCEL}}</a>
              </mat-card-actions>

              <div class ="row" *ngIf="onSuitCalculate">
                  <mat-spinner></mat-spinner>
              </div>

            </form>
            </div>
            <!-- Show Suit question  -->

            <div *ngIf="canSaveSuit"  class="container center-screen suitResult form_section"  >
                <!-- <div class="suitResult" *ngIf="canSaveSuit"> -->
                    <h4>{{formService.label_RiskLevel}}</h4>
                    <h4>{{ riskLevel }} - {{ riskLevelTxt }}</h4>
                    <p>{{ riskLevelDesc }}</p>

                    <a mat-flat-button color="accent" (click)="canDoSuit =false;canSaveSuit=false;suitModifyFlag=false" class ="act_button"> {{formService.LABEL_CANCEL}}</a>
                    <a mat-flat-button color="accent" (click)="canDoSuit =true;canSaveSuit = false;suitModifyFlag=false" class ="act_button" > {{formService.LABEL_EVA_AGAIN}}</a>
                    <button mat-flat-button   color="primary" (click)="evaluateSuitOK()" class ="act_button">OK</button>

              </div>
            <!-- </mat-card-content> -->
    </mat-step>

<!-- ***************** #4 Final  step -->
    <!-- <mat-step [stepControl]="firstFormGroup"  > -->
    <mat-step >
            <ng-template matStepLabel>{{formService.STEPER_4}}</ng-template>

            <div *ngIf="resultMsg?.length <= 0" class="center-screen form_section">

                <span id='finalText'>
                    <h5>{{formService.STEPPER_FINAL_CONFIRM}}</h5>
                    <p>{{formService.FINAL_MSG}}</p>
                </span>

                <span *ngIf='cddData.ReqModifyFlag '>
                    <li>Personal information OR FATCA was change.</li>
                </span>
                <span *ngIf='addrModifyFlag'>
                    <li>Address was chnage.</li>
                </span>
                <span *ngIf='suitModifyFlag'>
                    <li>Suitability was change.</li>
                    <p>Risk Level: {{ cust_RiskLevel }} - {{ cust_RiskLevelTxt }} </p>
                </span>
                <div>

                    <button mat-flat-button  matStepperPrevious color="accent" style="margin-left: 10px"><i class="fas fa-chevron-left"></i> {{formService.LABEL_BACK}}</button>
                    <button mat-flat-button  matStepperNext color="primary" style="margin-left: 10px" (click)="finalSaveAll()" >{{formService.LABEL_SAVE}}   <i class="far fa-save fa-2x"></i></button>
                  </div>
            </div>

            <!-- <div *ngIf="resultMsg?.length > 0" class="center-screen form_section">

                <span id='finalText'>
                    <h5>{{formService.STEPPER_FINAL_THANK}}</h5>
                </span>

            </div> -->
    </mat-step>
</mat-horizontal-stepper>
</div>

<div *ngIf="saveAllComplete" class="row center-screen Finish_section">

  <span >
      <h5>{{formService.STEPPER_FINAL_THANK}}</h5>
  </span>

</div>


</mat-card>
